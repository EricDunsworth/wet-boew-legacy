/*!
 * Geomap v1.3 / Géocarte v1.3
 * Web Experience Toolkit (WET) / Boîte à outils de l'expérience Web (BOEW)
 * www.tbs.gc.ca/ws-nw/wet-boew/terms / www.sct.gc.ca/ws-nw/wet-boew/conditions
 */
YUI.add("queryresults-base",function(A){function B(C){B.superclass.constructor.apply(this,arguments);}B.NAME="queryresults-base";B.ATTRS={headers:{value:{}},rows:{value:{}},pluginHighlight:{value:false,writeOnce:true,setter:"_setBooleanValue"},pluginRowClick:{value:false,writeOnce:true,setter:"_setBooleanValue"},pluginRowClickHeader:{value:""},pluginAria:{value:false,writeOnce:true,setter:"_setBooleanValue"},position:{value:"before"},currentPageNumber:{value:1,setter:"_setIntegerValue"},itemsPerPage:{value:10},pagesToDisplay:{value:10},pageButtons:{value:true},firstPageButton:{value:true},lastPageButton:{value:true},nextPageButton:{value:true},previousPageButton:{value:true},gotoPageSelector:{value:true},itemsPerPageSelector:{value:true},itemsPerPageValues:{value:[10,20,30,40,50]},strings:{value:A.Intl.get("queryresults"),readOnly:true}};B.HTML_PARSER={headers:function(F){var D,G={},C,E;if(F.test("table")){D=F.all("th");C=D.shift();E=1;while(C){G["c"+E]=C.get("text");C=D.shift();E+=1;}}return G;},rows:function(I){var G,E,H=[],J=[],C,F,D;if(I.test("table")){G=I.all("tbody tr");E=G.shift();if(E){E=E.all("td");F=1;while(E){if(!E.isEmpty()){C=E.shift();J=[];D=1;while(C){J.push(C.get("text"));C=E.shift();D+=1;}H.push(J);}E=G.shift();if(E){E=E.all("td");}F+=1;}}}return H;}};A.QueryresultsBase=A.extend(B,A.Widget,{initializer:function(){var C=this.get("contentBox");if(!C.test("div")){C=A.Node.create(this.CONTENT_TEMPLATE);this._set("contentBox",C);}},destructor:function(){},renderUI:function(){var C=this.get("contentBox");this.grid=new A.SimpleDatatable();if(this.get("pluginHighlight")){this.grid.plug(A.QueryresultsHighlight);}if(this.get("pluginRowClick")){this.grid.plug(A.QueryresultsClick);this.grid.queryresultsClick.set("pluginRowClickHeader",this.get("pluginRowClickHeader"));}if(this.get("pluginAria")){this.grid.plug(A.QueryresultsAria);}this.grid.plug(A.QueryresultsControls).render(C);this.grid.controls.setAttrs({position:this.get("position"),itemsPerPage:this.get("itemsPerPage"),pagesToDisplay:this.get("pagesToDisplay"),pageButtons:this.get("pageButtons"),firstPageButton:this.get("firstPageButton"),lastPageButton:this.get("lastPageButton"),nextPageButton:this.get("nextPageButton"),previousPageButton:this.get("previousPageButton"),gotoPageSelector:this.get("gotoPageSelector"),itemsPerPageSelector:this.get("itemsPerPageSelector"),itemsPerPageValues:this.get("itemsPerPageValues")});},bindUI:function(){this.after("headersChange",this._afterHeadersChange,this);this.after("rowsChange",this._afterRowsChange,this);this.after("pluginRowClickHeaderChange",this._afterRowClickHeaderChange,this);this.after("positionChange",this._afterControlsProperyChange,this);this.after("currentPageNumberChange",this.grid.controls.setCurrentPageNumber,this.grid.controls);this.after("itemsPerPageChange",this._afterControlsProperyChange,this);this.after("pagesToDisplayChange",this._afterControlsProperyChange,this);this.after("pageButtonsChange",this._afterControlsProperyChange,this);this.after("firstPageButtonChange",this._afterControlsProperyChange,this);this.after("lastPageButtonChange",this._afterControlsProperyChange,this);this.after("nextPageButtonChange",this._afterControlsProperyChange,this);this.after("previousPageButtonChange",this._afterControlsProperyChange,this);this.after("gotoPageSelectorChange",this._afterControlsProperyChange,this);this.after("itemsPerPageSelectorChange",this._afterControlsProperyChange,this);this.after("itemsPerPageValuesChange",this._afterControlsProperyChange,this);this.grid.on("queryresults:rowClick",this._onRowClick,this);this.grid.controls.after("currentPageNumberChange",this._afterCurrentPageNumberChange,this);},syncUI:function(){this.grid.set("headers",this.get("headers"));this.grid.setHeaders(this.get("headers"));this.grid.set("rows",this.get("rows"));if(this.grid.queryresultsClick){this.grid.queryresultsClick._addShowMoreButtonColumn();}},_afterHeadersChange:function(C){this.grid.set(C.attrName,C.newVal);this.grid.setHeaders(C.newVal);if(this.grid.queryresultsClick){this.grid.queryresultsClick._addShowMoreButtonColumn();}},_afterRowsChange:function(C){this.grid.set(C.attrName,C.newVal);if(this.grid.queryresultsClick){this.grid.queryresultsClick._addShowMoreButtonColumn();}},_afterRowClickHeaderChange:function(C){if(this.grid.queryresultsClick){this.grid.queryresultsClick.set("pluginRowClickHeader",C.newVal);this.grid.queryresultsClick._addShowMoreButtonColumn();}},_afterControlsProperyChange:function(C){this.grid.controls.set(C.attrName,C.newVal);},_onRowClick:function(C){this.fire("queryresults:rowClick",{"row":C.row});},_afterCurrentPageNumberChange:function(C){this.set("currentPageNumber",C.newVal);},_setIntegerValue:function(C,D){return parseInt(C,10);},_setBooleanValue:function(C,D){if(C){return true;}else{return false;}}});},"@VERSION@",{requires:["widget","substitute"],skinnable:true});YUI.add("queryresults-results",function(A){A.Queryresults=A.Base.build("queryresults",A.QueryresultsBase,[]);},"@VERSION@",{requires:["queryresults-base","base"]});YUI.add("queryresults-highlight",function(A){function B(C){B.superclass.constructor.apply(this,arguments);}B.NAME="highlight";B.NS="plugin-queryresults-highlight";A.QueryresultsHighlight=A.extend(B,A.Plugin.Base,{initializer:function(C){this.afterHostEvent("render",this._afterHostRenderEvent);},destructor:function(){var D=this.get("host"),C=D.get("boundingBox");C.detach();},_afterHostRenderEvent:function(E){var D=this.get("host"),C=D.get("boundingBox");C.delegate("mouseenter",this._onMouseEnterLeave,"table tr");C.delegate("mouseleave",this._onMouseEnterLeave,"table tr");},_onMouseEnterLeave:function(C){C.currentTarget.toggleClass("queryresults-highlight-hover");}});},"@VERSION@",{requires:["plugin"]});YUI.add("queryresults-aria",function(B){function A(C){A.superclass.constructor.apply(this,arguments);}A.NAME="queryresults-aria";A.NS="aria";B.QueryresultsAria=B.extend(A,B.Plugin.Base,{initializer:function(C){this.afterHostEvent("render",this._afterHostRenderEvent);
this.afterHostMethod("setRows",this._afterHostSetRowsMethod);this.afterHostMethod("setHeaders",this._afterHostsetHeadersMethod);},destructor:function(){},_afterHostRenderEvent:function(E){var D=this.get("host"),C=D.get("boundingBox");C.set("aria-live","polite");C.one("table").setAttrs({"role":"grid","aria-readonly":"true"});},_afterHostsetHeadersMethod:function(D){var E=this.get("host"),C=E.get("boundingBox");C.all("thead th").set("role","columnheader");C.all("thead tr").set("role","row");},_afterHostSetRowsMethod:function(D){var E=this.get("host"),C=E.get("boundingBox");C.all("tbody tr").set("role","row");C.all("tbody tr td").set("role","gridcell");}});},"@VERSION@",{requires:["plugin"]});YUI.add("queryresults-controls",function(C){var A=C.Lang;function B(D){B.superclass.constructor.apply(this,arguments);}B.NAME="queryresults-contorls";B.NS="controls";B.ATTRS={position:{value:"before",setter:"_setPosition"},pagesToDisplay:{value:10,setter:"_setIntegerValue"},pageButtons:{value:true,setter:"_setBooleanValue"},firstPageButton:{value:false,setter:"_setBooleanValue"},lastPageButton:{value:false,setter:"_setBooleanValue"},nextPageButton:{value:true,setter:"_setBooleanValue"},previousPageButton:{value:true,setter:"_setBooleanValue"},gotoPageSelector:{value:false,setter:"_setBooleanValue"},itemsPerPageSelector:{value:false,setter:"_setBooleanValue"},itemsPerPageValues:{value:undefined,validator:"_validateItemsPerPageValues"},strings:{value:C.Intl.get("queryresults")}};C.QueryresultsControls=C.extend(B,C.Plugin.SDTPaginateClient,{initializer:function(D){this.host=this.get("host");this.afterHostEvent("render",this._afterHostRenderEvent);C.Intl.after("intl:langChange",this._afterLangChange,this);},destructor:function(){},setCurrentPageNumber:function(D){var E=this.get("numberOfPages");if((D.newVal>=1)&&(D.newVal<=E)){this.set("currentPageNumber",D.newVal);}},_setupControls:function(){var E=this.host.get("boundingBox"),D=this.get("position");this._calculateItemsPerPageArray();this._controls={};this._controls.before=this._renderControlsDivs("before");this._controls.after=this._renderControlsDivs("after");E.insert(this._controls[D].boundingDiv,D);this._refreshControls();},_calculateItemsPerPageArray:function(){var D=this.get("itemsPerPageValues"),E=this.get("totalItems"),F;if(!D){F=function(H,G){return H-G;};D=[this.get("itemsPerPage"),Math.round(E*0.1/10)*10,Math.round(E*0.2/10)*10,Math.round(E*0.3/10)*10,Math.round(E*0.5/10)*10].sort(F);this.set("itemsPerPageValues",D);}},_renderControlsDivs:function(E){var F,D;F=C.Node.create(C.substitute(this.DIV,{divClass:this.host.getClassName("controls")}));F.addClass(this.host.getClassName(E,"controls"));D=C.Node.create(C.substitute(this.DIV,{divClass:this.host.getClassName("controls","content")}));F.appendChild(D);return{"boundingDiv":F,"contentDiv":D};},_refreshControls:function(E){var D=this.get("position");if(D==="both"){this._renderControls(this._controls.before.contentDiv,E);this._renderControls(this._controls.after.contentDiv,E);}else{this._renderControls(this._controls[D].contentDiv,E);}},_renderControls:function(E,D){if(D){E.purge(true);E.get("childNodes").remove(true);}this._calculateStartEndPages();this._renderDisplayedLabel(E);this._renderPageButtons(E);this._renderSelectors(E);},_calculateStartEndPages:function(){var D=this.get("currentPageNumber"),F=this.get("numberOfPages"),E=this.get("pagesToDisplay");this.startPage=Math.max(1,D-Math.ceil(E/2-1));if((F-this.startPage)<E){this.startPage=Math.max(1,F-E+1);}this.endPage=Math.min(F,this.startPage+E-1);},_renderDisplayedLabel:function(H){var F,E=this.get("currentIndex"),I=this.get("totalItems"),G=this.get("itemsPerPage"),D=this.get("strings");F=C.Node.create(C.substitute(this.RECORDS_LABEL_TEMPLATE,{wordDisplayRecord:D.word_display_record,recordFrom:E,prepTo:D.prep_to,recordTo:Math.min(E+G-1,I),prepOf:D.prep_of,recordOf:I,wordRecords:D.word_records,labelledByClass:this.host.getClassName("controls","displayed"),id:C.guid()}));H.appendChild(F);},_renderPageButtons:function(H){var F,I,G,E=this.get("currentPageNumber"),J=this.get("numberOfPages"),D=this.get("strings");F=C.Node.create(C.substitute(this.LABEL_TEMPLATE,{paginationText:D.pagination_text,labelledByClass:this.host.getClassName("controls","audible"),id:C.guid()}));H.appendChild(F);I=C.Node.create(C.substitute(this.LIST_TEMPLATE,{paginationListClass:this.host.getClassName("controls","list"),labelId:F.get("id")}));if(E!==1){this._renderPageButton(I,"firstPageButton",D.first_page_alt,D.first_page_text,1);this._renderPageButton(I,"previousPageButton",D.previous_page_alt,D.previous_page_text,E-1);}for(G=this.startPage;G<E;G+=1){this._renderPageButton(I,"pageButtons",D.page_button_alt,G,G);}this._renderPageSpan(I,"pageButtons",D.current_page_button_alt,E);for(G=E+1;G<=this.endPage;G+=1){this._renderPageButton(I,"pageButtons",D.page_button_alt,G,G);}if(E!==J){this._renderPageButton(I,"nextPageButton",D.next_page_alt,D.next_page_text,E+1);this._renderPageButton(I,"lastPageButton",D.last_page_alt,D.last_page_text,J);}H.appendChild(I);},_setPaginationListeners:function(){this._controls.before.boundingDiv.delegate("click",this._onPageButtonClick,"a.yui3-sdt-controls-page-button",this);this._controls.after.boundingDiv.delegate("click",this._onPageButtonClick,"a.yui3-sdt-controls-page-button",this);},_renderSelectors:function(D){if(this.get("gotoPageSelector")){this._renderGotoPageSelector(D);}if(this.get("itemsPerPageSelector")){this._renderItemsPerPageSelector(D);}},_renderPageButton:function(G,E,H,I,F){var J=this.get("numberOfPages"),D;if((this.get(E))&&(F>=1)&&(F<=J)){D=C.Node.create(this.ITEM_TEMPLATE);D.appendChild(C.Node.create(C.substitute(this.BUTTON_TEMPLATE,{pageButtonClass:this.host.getClassName("controls","page","button"),text:I,spanButtonClass:this.host.getClassName("controls","audible"),spanText:H,href:"#page"+F})).setData("toPage",F));G.appendChild(D);}},_renderPageSpan:function(E,D,F,G){if(this.get(D)){E.appendChild(C.Node.create(C.substitute(this.CURRENT_PAGE_TEMPLATE,{pageCurrentClass:this.host.getClassName("controls","page","current"),text:G,spanButtonClass:this.host.getClassName("controls","audible"),spanText:F})));
}},_renderGotoPageSelector:function(H){var F=this.get("currentPageNumber"),K=this.get("numberOfPages"),E=this.get("strings"),G,J,I,D;I=C.Node.create(C.substitute(this.SELECTOR_TEMPLATE,{selectorClass:this.host.getClassName("controls","page","selector"),selectorId:C.guid()}));J=C.Node.create(C.substitute(this.SPAN_TEMPLATE,{text:E.goto_page_label,spanClass:this.host.getClassName("controls","page","selector","label"),forId:I.get("id")}));for(G=1;G<=K;G+=1){D=false;if(G===F){D=true;}I.appendChild(C.Node.create(C.substitute(this.OPTION_TEMPLATE,{value:G,textValue:G})).set("selected",D));}I.on("change",this._onGotoSelectroChange,this);H.appendChild(J);H.appendChild(I);},_renderItemsPerPageSelector:function(K){var J=this.get("itemsPerPageValues"),I=this.get("itemsPerPage"),E=this.get("strings"),H,G,F,D;F=C.Node.create(C.substitute(this.SELECTOR_TEMPLATE,{selectorClass:this.host.getClassName("controls","items","selector"),selectorId:C.guid()}));G=C.Node.create(C.substitute(this.SPAN_TEMPLATE,{text:E.items_per_page_label,spanClass:this.host.getClassName("controls","items","selector","label"),forId:F.get("id")}));for(H=0;H<J.length;H+=1){D=false;if(J[H]===I){D=true;}F.appendChild(C.Node.create(C.substitute(this.OPTION_TEMPLATE,{value:J[H],textValue:J[H]})).set("selected",D));}F.on("change",this._onItemsPerPageChange,this);K.appendChild(G);K.appendChild(F);},_onPageButtonClick:function(E){var D=E.currentTarget.getData("toPage");E.halt();this.set("currentPageNumber",D);},_onGotoSelectroChange:function(E){var D=E.target.get("value");E.halt();this.set("currentPageNumber",D);},_onItemsPerPageChange:function(E){var D=E.target.get("value");E.halt();this.set("itemsPerPage",D);},_afterHostRenderEvent:function(D){this._setupControls();this._setPaginationListeners();this.afterHostMethod("setRows",this._afterHostMethodSetRows,this);this.after("positionChange",this._afterPositionChange,this);this.after("pagesToDisplayChange",this._afterProperyChange,this);this.after("pageButtonsChange",this._afterProperyChange,this);this.after("firstPageButtonChange",this._afterProperyChange,this);this.after("lastPageButtonChange",this._afterProperyChange,this);this.after("nextPageButtonChange",this._afterProperyChange,this);this.after("previousPageButtonChange",this._afterProperyChange,this);this.after("gotoPageSelectorChange",this._afterProperyChange,this);this.after("itemsPerPageSelectorChange",this._afterProperyChange,this);this.after("itemsPerPageValuesChange",this._afterItemsPerPageValuesChange,this);},_afterLangChange:function(D){if(D.module==="queryresults"){this.set("strings",C.Intl.get("queryresults"));this._refreshControls(true);}},_setPosition:function(D,E){if(D==="before"){return"before";}else{if(D==="after"){return"after";}else{return"both";}}},_setIntegerValue:function(D,E){return parseInt(D,10);},_setBooleanValue:function(D,E){if(D){return true;}else{return false;}},_validateItemsPerPageValues:function(D,F){var E;if(A.isArray(D)){for(E=0;E<D.length;E+=1){if(!A.isNumber(D[E])){return false;}}return true;}else{return false;}},_afterHostMethodSetRows:function(D){this._refreshControls(true);},_afterPositionChange:function(E){var D=this.host.get("boundingBox");if(E.newVal==="both"){if(E.prevVal==="before"){D.insert(this._controls.after.boundingDiv,"after");}else{D.insert(this._controls.before.boundingDiv,"before");}}else{if(E.prevVal==="both"){if(E.newVal==="before"){this._controls.after.boundingDiv.remove();}else{this._controls.before.boundingDiv.remove();}}else{this._controls[E.prevVal].boundingDiv.remove();}D.insert(this._controls[E.newVal].boundingDiv,E.newVal);}this._refreshControls(true);},_afterProperyChange:function(D){this._refreshControls(true);},_afterItemsPerPageValuesChange:function(F){var E=this.get("itemsPerPage"),D;if(C.Array.indexOf(F.newVal,E)===-1){if(F.newVal[0]){D=F.newVal[0];this.set("itemsPerPage",D);}}this._refreshControls(true);},DIV:'<div class="{divClass}"></div>',LABEL_TEMPLATE:'<p class="{labelledByClass}" id="{id}">{paginationText}</p>',RECORDS_LABEL_TEMPLATE:'<p class="{labelledByClass}" id="{id}">{wordDisplayRecord} {recordFrom} {prepTo} {recordTo} {prepOf} {recordOf} {wordRecords}</p>',LIST_TEMPLATE:'<ul class="{paginationListClass}" role="navigation" aria-labelledby="{labelId}"></ul>',BUTTON_TEMPLATE:'<a href="{href}" class="{pageButtonClass}">'+'<span class="{spanButtonClass}">{spanText}</span>'+"{text}"+"</a>",ITEM_TEMPLATE:"<li></li>",CURRENT_PAGE_TEMPLATE:'<li><span class="{pageCurrentClass}">'+'<span class="{spanButtonClass}">{spanText}</span>'+"{text}"+"</span>"+"</li>",SPAN_TEMPLATE:'<label class="{spanClass}" for="{forId}">{text}</label>',SELECTOR_TEMPLATE:'<select class="{selectorClass}" id={selectorId} ></select>',OPTION_TEMPLATE:'<option value="{value}">{textValue}</option>'});},"@VERSION@",{requires:["plugin","gallery-plugin-simple-datatable-paginate-client"]});YUI.add("queryresults-click",function(B){function A(C){A.superclass.constructor.apply(this,arguments);}A.NAME="queryresults-click";A.NS="queryresultsClick";A.ATTRS={strings:{value:B.Intl.get("queryresults")},pluginRowClickHeader:{value:""}};B.QueryresultsClick=B.extend(A,B.Plugin.Base,{initializer:function(C){this.beforeHostMethod("syncUI",this._beforeHostSyncUIMethod);this.afterHostEvent("render",this._afterHostRenderEvent);B.Intl.after("intl:langChange",this._afterLangChange,this);},destructor:function(){},_beforeHostSyncUIMethod:function(C){this._addShowMoreButtonColumn();},_afterHostRenderEvent:function(E){var D=this.get("host"),C=D.get("boundingBox");C.delegate("click",this._onMouseClick,"tbody tr",this);},_onMouseClick:function(E){var D=this.get("host"),J=D.get("headers"),G=D.get("rows"),F={},H,I,C;E.halt();C=E.target.getAttribute("rowid");if(C){I=G[C];for(H in I){if((I.hasOwnProperty(H))&&(H!=="button")){F[H]=I[H];}}D.fire("queryresults:rowClick",{"row":F});}},_addShowMoreButtonColumn:function(){var G=this.get("host"),I=G.get("headers"),H=G.get("rows"),C=this.get("strings"),D=this.get("pluginRowClickHeader"),F="",E;
I.button=C.show_button_header;for(E=0;E<H.length;E+=1){if(H[E][D]){F=B.substitute(this.SPAN_TEMPLATE,{spanClass:G.getClassName("controls","audible"),spanText:B.substitute(C.show_button_title_about,{"cellText":H[E][D]})});}else{F=B.substitute(this.SPAN_TEMPLATE,{spanClass:G.getClassName("controls","audible"),spanText:B.substitute(C.show_button_title_information,{"number":(E+1)})});}H[E].button=B.substitute(this.SHOW_BUTTON_TEMPLATE,{rowid:E,text:C.show_button_label,showButtonClass:G.getClassName("show","button"),title:C.show_button_title,span:F});}G.setHeaders(I);G.set("headers",I);G.setRows(H);G.set("rows",H);},_afterLangChange:function(C){if(C.module==="queryresults"){this.set("strings",B.Intl.get("queryresults"));this._addShowMoreButtonColumn();}},SHOW_BUTTON_TEMPLATE:'<a href="javascript:void(0)" role="button" class="{showButtonClass}" rowid="{rowid}">'+"{text}{span}"+"</a>",SPAN_TEMPLATE:'<span class="{spanClass}">{spanText}</span>'});},"@VERSION@",{requires:["plugin","substitute"]});YUI.add("queryresults",function(A){},"@VERSION@",{use:["queryresults-results","queryresults-base","queryresults-highlight","queryresults-aria","queryresults-controls","queryresults-click"],skinnable:true});